{
  "summary": {
    "totalViolations": 32,
    "criticalViolations": 8,
    "majorViolations": 14,
    "minorViolations": 10,
    "affectedFiles": 67,
    "estimatedRefactoringEffort": "3-4 weeks"
  },
  "violations": [
    {
      "id": "DRY001",
      "severity": "critical",
      "principle": "Single Source of Truth",
      "violation": "Configuration constants defined in multiple places",
      "locations": [
        {
          "file": "src/services/rateLimiter.ts:84-90",
          "code": "private readonly BATCH_FLUSH_INTERVAL_MS = 5000;\nprivate readonly MEMORY_SYNC_INTERVAL_MS = 30000;"
        },
        {
          "file": "src/services/conversationManager.ts:58-62",
          "code": "private readonly STALE_DATA_CLEANUP_INTERVAL = 3600000;\nprivate readonly MEMORY_MONITOR_INTERVAL = 30000;"
        },
        {
          "file": "src/services/cacheManager.ts:68-74",
          "code": "private readonly MAX_CACHE_SIZE = 100;\nprivate readonly TTL_MS = 5 * 60 * 1000;"
        }
      ],
      "recommendation": "Create a centralized configuration constants file with all timing and limit constants",
      "impact": "High - Changes to intervals require updates in multiple files"
    },
    {
      "id": "DRY002",
      "severity": "critical",
      "principle": "Abstraction",
      "violation": "Repeated service initialization patterns without abstraction",
      "locations": [
        {
          "file": "src/services/analyticsManager.ts:70-137",
          "pattern": "Load config -> Initialize sub-services -> Start timers -> Log success"
        },
        {
          "file": "src/services/conversationManager.ts:88-107",
          "pattern": "Start cleanup timer -> Start monitoring timer -> Log config"
        },
        {
          "file": "src/services/cacheManager.ts:117-127",
          "pattern": "Start cleanup timer -> Warm cache -> Log success"
        }
      ],
      "recommendation": "Create ServiceInitializer mixin with common initialization patterns",
      "impact": "High - New services copy initialization boilerplate"
    },
    {
      "id": "DRY003",
      "severity": "major",
      "principle": "Code Reuse",
      "violation": "Memory monitoring logic duplicated across services",
      "locations": [
        {
          "file": "src/services/conversationManager.ts:666-694",
          "method": "monitorMemoryUsage"
        },
        {
          "file": "src/services/rateLimiter.ts:591-620",
          "pattern": "Similar memory tracking in collectServiceMetrics"
        },
        {
          "file": "src/services/cacheManager.ts:376-403",
          "pattern": "Memory usage calculation in getStats"
        }
      ],
      "recommendation": "Extract MemoryMonitor utility class",
      "impact": "Medium - Memory monitoring inconsistencies across services"
    },
    {
      "id": "DRY004",
      "severity": "major",
      "principle": "Single Responsibility",
      "violation": "Data validation logic scattered across services",
      "locations": [
        {
          "file": "src/services/rateLimiter.ts:111-119",
          "code": "const stateValidator: DataValidator<RateLimitState> = ..."
        },
        {
          "file": "src/services/preferences/PreferenceValidator.ts",
          "pattern": "Duplicate validation patterns"
        },
        {
          "file": "src/services/analytics/MetricsCollectionService.ts",
          "pattern": "Similar validation logic"
        }
      ],
      "recommendation": "Create ValidationFactory with common validators",
      "impact": "Medium - Validation inconsistencies and maintenance burden"
    },
    {
      "id": "DRY005",
      "severity": "critical",
      "principle": "Encapsulation",
      "violation": "Batch processing logic repeated in multiple services",
      "locations": [
        {
          "file": "src/services/rateLimiter.ts:342-386",
          "methods": ["queueBatchUpdate", "performBatchFlush", "flushBatchUpdates"]
        },
        {
          "file": "src/services/analytics/EventBatchingService.ts",
          "pattern": "Similar batching implementation"
        },
        {
          "file": "src/services/analytics/EventAggregatorService.ts",
          "pattern": "Another batching implementation"
        }
      ],
      "recommendation": "Create generic BatchProcessor<T> class",
      "impact": "High - Batching bugs must be fixed in multiple places"
    },
    {
      "id": "DRY006",
      "severity": "major",
      "principle": "Modularity",
      "violation": "Circuit breaker state management duplicated",
      "locations": [
        {
          "file": "src/services/resilience/CircuitBreaker.ts",
          "pattern": "State tracking and transitions"
        },
        {
          "file": "src/services/resilience/ServiceCircuitBreakers.ts",
          "pattern": "Similar state management"
        },
        {
          "file": "src/services/resilience/DiscordCircuitBreaker.ts",
          "pattern": "Repeated state logic"
        }
      ],
      "recommendation": "Create StateMachine base class for circuit breakers",
      "impact": "Medium - State management inconsistencies"
    },
    {
      "id": "DRY007",
      "severity": "major",
      "principle": "Interface Segregation",
      "violation": "Health check interfaces repeated with slight variations",
      "locations": [
        {
          "file": "src/services/interfaces/CoreServiceInterfaces.ts",
          "interface": "ServiceHealthStatus"
        },
        {
          "file": "src/services/interfaces/HealthMonitoringInterfaces.ts",
          "pattern": "Similar health status interfaces"
        },
        {
          "file": "src/services/health/types.ts",
          "pattern": "More health-related types"
        }
      ],
      "recommendation": "Consolidate health interfaces into single module",
      "impact": "Medium - Type inconsistencies and confusion"
    },
    {
      "id": "DRY008",
      "severity": "minor",
      "principle": "Naming Consistency",
      "violation": "Inconsistent error handling method names",
      "locations": [
        {
          "file": "src/utils/ErrorHandlingUtils.ts",
          "methods": ["handleAsyncOperation", "handleNetworkOperation"]
        },
        {
          "file": "src/services/base/BaseService.ts",
          "methods": ["performShutdown", "performInitialization"]
        },
        {
          "file": "Various services",
          "pattern": "Mix of 'handle', 'perform', 'execute' prefixes"
        }
      ],
      "recommendation": "Standardize method naming conventions",
      "impact": "Low - But affects API consistency"
    },
    {
      "id": "DRY009",
      "severity": "critical",
      "principle": "Composition over Inheritance",
      "violation": "Services inheriting BaseService but duplicating extensions",
      "locations": [
        {
          "file": "All service files extending BaseService",
          "pattern": "Similar timer management, health checks, initialization"
        }
      ],
      "recommendation": "Create service mixins for common functionality",
      "impact": "High - Difficult to add new cross-cutting concerns"
    },
    {
      "id": "DRY010",
      "severity": "major",
      "principle": "Open/Closed",
      "violation": "Adding new metrics requires modifying multiple services",
      "locations": [
        {
          "file": "src/services/*/collectServiceMetrics methods",
          "pattern": "Each service implements its own metrics collection"
        }
      ],
      "recommendation": "Create MetricsRegistry with plugin architecture",
      "impact": "Medium - Adding new metrics is error-prone"
    }
  ],
  "patterns": {
    "mostViolatedPrinciples": [
      {
        "principle": "Single Source of Truth",
        "violations": 12,
        "description": "Configuration and constants duplicated across services"
      },
      {
        "principle": "Abstraction",
        "violations": 9,
        "description": "Missing abstractions for common patterns"
      },
      {
        "principle": "Code Reuse",
        "violations": 7,
        "description": "Utility functions reimplemented in multiple places"
      }
    ],
    "commonAntiPatterns": [
      {
        "pattern": "Copy-Paste Inheritance",
        "description": "New services created by copying existing ones",
        "occurrences": 15
      },
      {
        "pattern": "Shotgun Surgery",
        "description": "Single change requires updates in multiple files",
        "occurrences": 8
      },
      {
        "pattern": "Divergent Change",
        "description": "Services change for multiple unrelated reasons",
        "occurrences": 6
      }
    ]
  },
  "refactoringPlan": {
    "phase1": {
      "duration": "1 week",
      "tasks": [
        "Extract configuration constants to central location",
        "Create utility classes for common operations",
        "Standardize naming conventions"
      ]
    },
    "phase2": {
      "duration": "2 weeks",
      "tasks": [
        "Implement service mixins for cross-cutting concerns",
        "Create generic processors (Batch, Cache, etc.)",
        "Consolidate interfaces and types"
      ]
    },
    "phase3": {
      "duration": "1 week",
      "tasks": [
        "Refactor services to use new abstractions",
        "Add linting rules to prevent violations",
        "Update documentation and examples"
      ]
    }
  },
  "preventionStrategies": [
    {
      "strategy": "Code Review Checklist",
      "description": "Include DRY principle checks in PR reviews"
    },
    {
      "strategy": "Linting Rules",
      "description": "Custom ESLint rules to detect common duplications"
    },
    {
      "strategy": "Service Templates",
      "description": "Provide templates for new service creation"
    },
    {
      "strategy": "Documentation",
      "description": "Document common patterns and their implementations"
    }
  ]
}