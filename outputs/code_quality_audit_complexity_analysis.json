{
  "complexity_analysis": {
    "analysis_timestamp": "2025-01-07T16:00:00Z",
    "project_overview": {
      "total_files_analyzed": 38,
      "total_lines_of_code": 18094,
      "average_file_size": 476,
      "largest_files": [
        "src/services/interfaces/index.ts (1313 lines)",
        "src/services/analyticsManager.ts (1105 lines)",
        "src/services/configurationManager.ts (965 lines)",
        "src/commands/index.ts (911 lines)",
        "src/services/helpSystem.ts (803 lines)"
      ]
    },
    "cyclomatic_complexity": {
      "high_complexity_functions": [
        {
          "file": "src/services/gemini.ts",
          "function": "generateResponse",
          "line_start": 187,
          "line_end": 282,
          "complexity_score": 18,
          "lines": 95,
          "issues": [
            "Nested conditionals >4 levels deep",
            "Multiple exit points (9 returns/throws)",
            "Mixed concerns: validation, degradation, caching, retry logic",
            "Function exceeds 50 line threshold"
          ],
          "risk_level": "HIGH"
        },
        {
          "file": "src/services/gemini.ts",
          "function": "performAIGeneration",
          "line_start": 284,
          "line_end": 406,
          "complexity_score": 15,
          "lines": 122,
          "issues": [
            "Deeply nested control structures",
            "Complex prompt building logic",
            "Multiple conditional branches",
            "Function exceeds 50 line threshold significantly"
          ],
          "risk_level": "HIGH"
        },
        {
          "file": "src/services/roastingEngine.ts",
          "function": "shouldRoast",
          "line_start": 106,
          "line_end": 252,
          "complexity_score": 22,
          "lines": 146,
          "issues": [
            "Extremely complex decision tree",
            "Multiple nested conditionals",
            "State mutations throughout method",
            "Function exceeds 50 line threshold by 3x",
            "Psychological warfare logic adds unpredictable complexity"
          ],
          "risk_level": "CRITICAL"
        },
        {
          "file": "src/services/contextManager.ts",
          "function": "buildSuperContext",
          "line_start": 111,
          "line_end": 198,
          "complexity_score": 12,
          "lines": 87,
          "issues": [
            "Multiple data source aggregation",
            "Nested loops and conditionals",
            "Side effects (updating access counts)",
            "Function exceeds 50 line threshold"
          ],
          "risk_level": "HIGH"
        },
        {
          "file": "src/handlers/eventHandlers.ts",
          "function": "handleMessageCreate",
          "line_start": 161,
          "line_end": 293,
          "complexity_score": 14,
          "lines": 132,
          "issues": [
            "Deep nesting (>5 levels)",
            "Complex error handling paths",
            "Mixed Discord API and business logic",
            "Function exceeds 50 line threshold significantly"
          ],
          "risk_level": "HIGH"
        },
        {
          "file": "src/handlers/commandHandlers.ts",
          "function": "handleChatCommand",
          "line_start": 28,
          "line_end": 103,
          "complexity_score": 11,
          "lines": 75,
          "issues": [
            "Nested try-catch blocks",
            "Complex channel type handling",
            "Function exceeds 50 line threshold"
          ],
          "risk_level": "MEDIUM"
        },
        {
          "file": "src/services/behaviorAnalyzer.ts",
          "function": "analyzeMessage",
          "line_start": 34,
          "line_end": 88,
          "complexity_score": 10,
          "lines": 54,
          "issues": [
            "Multiple sequential operations",
            "Pattern extraction complexity",
            "Function exceeds 50 line threshold"
          ],
          "risk_level": "MEDIUM"
        }
      ],
      "complexity_distribution": {
        "low_complexity_0_to_5": 28,
        "medium_complexity_6_to_10": 16,
        "high_complexity_11_to_20": 8,
        "critical_complexity_over_20": 2
      },
      "violations": {
        "functions_over_10_complexity": 10,
        "functions_over_50_lines": 12,
        "functions_with_deep_nesting": 8
      }
    },
    "cognitive_complexity": {
      "readability_issues": [
        {
          "file": "src/services/roastingEngine.ts",
          "issues": [
            "Chaos mode logic with random overrides",
            "Psychological warfare patterns",
            "Complex memoization cache management",
            "Mixed concerns: probability, psychology, caching"
          ],
          "cognitive_load": "EXTREME"
        },
        {
          "file": "src/services/gemini.ts",
          "issues": [
            "Monolithic constructor with 12 dependencies",
            "Mixed API integration and business logic",
            "Complex error mapping logic",
            "Unclear separation of concerns"
          ],
          "cognitive_load": "HIGH"
        },
        {
          "file": "src/services/contextManager.ts",
          "issues": [
            "Multiple domain service coordination",
            "Mixed memory management strategies",
            "Complex cross-server logic",
            "Unclear service boundaries"
          ],
          "cognitive_load": "HIGH"
        }
      ],
      "naming_clarity": {
        "confusing_names": [
          "performAIGeneration (not clear vs generateResponse)",
          "buildSuperContext (unclear what 'super' means)",
          "shouldRoast (doesn't indicate complexity of logic)",
          "updateDynamicRoastingState (vague about what updates)"
        ],
        "overly_long_names": [
          "createAIServiceWithDependencies",
          "handleMessageReactionAdd", 
          "buildTruncatedPrompt"
        ]
      },
      "variable_scope_issues": [
        {
          "file": "src/services/roastingEngine.ts",
          "issue": "Complex state management across multiple maps and objects",
          "impact": "High cognitive load to track state changes"
        },
        {
          "file": "src/services/gemini.ts", 
          "issue": "Many instance variables with unclear lifecycle",
          "impact": "Difficult to understand object state"
        }
      ]
    },
    "structural_complexity": {
      "inheritance_issues": [
        {
          "type": "Interface Complexity",
          "file": "src/services/interfaces/index.ts",
          "issue": "Monolithic interface file with 1313 lines",
          "impact": "Single file contains all type definitions",
          "recommendation": "Split into domain-specific interface files"
        }
      ],
      "coupling_issues": [
        {
          "type": "High Constructor Coupling",
          "file": "src/services/gemini.ts",
          "issue": "Constructor requires 12 dependencies",
          "dependencies": [
            "IRateLimiter",
            "IContextManager", 
            "IPersonalityManager",
            "ICacheManager",
            "IGracefulDegradationService",
            "IRoastingEngine",
            "IConversationManager",
            "IRetryHandler",
            "ISystemContextBuilder",
            "IHealthMonitor",
            "Client"
          ],
          "impact": "Difficult to test, high coupling, brittle to changes"
        },
        {
          "type": "Circular Dependencies Risk",
          "file": "src/services/contextManager.ts",
          "issue": "Coordinates multiple domain services but also consumed by them",
          "impact": "Potential circular dependency issues"
        }
      ],
      "cohesion_issues": [
        {
          "file": "src/services/gemini.ts",
          "issue": "Mixes AI service logic with context building, caching, retry logic",
          "recommendation": "Extract context building and caching to separate services"
        },
        {
          "file": "src/handlers/eventHandlers.ts",
          "issue": "Mixes Discord event handling with business logic",
          "recommendation": "Extract business logic to dedicated services"
        }
      ],
      "architectural_antipatterns": [
        {
          "pattern": "God Object",
          "file": "src/services/gemini.ts",
          "description": "GeminiService handles too many responsibilities",
          "responsibilities": [
            "AI API integration",
            "Context management",
            "Caching",
            "Rate limiting coordination",
            "Error handling",
            "Prompt building",
            "Response processing"
          ]
        },
        {
          "pattern": "Feature Envy",
          "file": "src/services/contextManager.ts",
          "description": "ContextManager deeply manipulates data from domain services",
          "impact": "Violates encapsulation principles"
        },
        {
          "pattern": "Long Parameter List",
          "file": "src/services/gemini.ts",
          "function": "generateResponse",
          "parameters": 7,
          "recommendation": "Use parameter object pattern"
        }
      ]
    },
    "refactoring_recommendations": [
      {
        "priority": "CRITICAL",
        "file": "src/services/roastingEngine.ts",
        "function": "shouldRoast",
        "actions": [
          "Extract probability calculation to separate method",
          "Extract chaos mode logic to separate service",
          "Extract psychological warfare patterns to strategy classes",
          "Simplify decision tree with strategy pattern"
        ],
        "estimated_effort": "8-12 hours"
      },
      {
        "priority": "HIGH",
        "file": "src/services/gemini.ts",
        "function": "generateResponse",
        "actions": [
          "Extract validation logic to separate method",
          "Extract degradation handling to middleware",
          "Extract prompt building to dedicated service",
          "Simplify control flow with early returns"
        ],
        "estimated_effort": "6-8 hours"
      },
      {
        "priority": "HIGH",
        "file": "src/services/gemini.ts",
        "function": "performAIGeneration", 
        "actions": [
          "Extract context building logic",
          "Extract response processing to separate method",
          "Reduce nested conditionals",
          "Split into smaller focused methods"
        ],
        "estimated_effort": "4-6 hours"
      },
      {
        "priority": "MEDIUM",
        "file": "src/handlers/eventHandlers.ts",
        "function": "handleMessageCreate",
        "actions": [
          "Extract message processing to service layer",
          "Extract context building logic",
          "Simplify error handling",
          "Reduce nesting depth"
        ],
        "estimated_effort": "4-6 hours"
      },
      {
        "priority": "MEDIUM",
        "file": "src/services/interfaces/index.ts",
        "actions": [
          "Split into domain-specific interface files",
          "Group related interfaces together",
          "Extract common type definitions"
        ],
        "estimated_effort": "2-4 hours"
      }
    ],
    "code_metrics": {
      "maintainability_index": {
        "overall_score": 65,
        "breakdown": {
          "high_maintainability_80_plus": 12,
          "medium_maintainability_60_to_80": 18,
          "low_maintainability_40_to_60": 6,
          "very_low_maintainability_below_40": 2
        }
      },
      "technical_debt": {
        "estimated_hours": 24,
        "critical_issues": 2,
        "high_priority_issues": 5,
        "medium_priority_issues": 8
      },
      "testability_score": {
        "overall": 55,
        "issues": [
          "High constructor coupling makes unit testing difficult",
          "Complex methods with multiple responsibilities",
          "Side effects in core business logic",
          "Dependency on external services without clear interfaces"
        ]
      }
    }
  }
}