{
  "metadata": {
    "analysis_type": "complexity_analysis",
    "timestamp": "2025-06-07T20:51:04Z",
    "files_analyzed": 90,
    "complexity_threshold": 10,
    "function_length_threshold": 50,
    "nesting_depth_threshold": 4
  },
  "summary": {
    "high_complexity_files": 4,
    "medium_complexity_files": 12,
    "low_complexity_files": 74,
    "total_complexity_violations": 23,
    "average_file_complexity": 8.2,
    "highest_complexity_score": 47
  },
  "high_complexity_files": [
    {
      "path": "src/services/gemini.ts",
      "complexity_score": 47,
      "lines": 732,
      "violations": [
        {
          "type": "cyclomatic_complexity",
          "function": "generateResponse",
          "line_range": "187-282",
          "complexity": 22,
          "description": "Complex AI generation logic with multiple branching paths for degradation, caching, rate limiting, and error handling",
          "severity": "high"
        },
        {
          "type": "function_length",
          "function": "performAIGeneration",
          "line_range": "284-406",
          "lines": 122,
          "description": "Extremely long function handling prompt building, context aggregation, and API calls",
          "severity": "critical"
        },
        {
          "type": "cognitive_complexity",
          "function": "processGeminiResponse",
          "line_range": "460-524",
          "complexity": 15,
          "description": "Nested conditionals for response validation and error handling",
          "severity": "high"
        },
        {
          "type": "parameter_complexity",
          "function": "generateResponse",
          "parameters": 7,
          "description": "Too many parameters making function hard to understand and maintain",
          "severity": "medium"
        }
      ],
      "refactoring_priority": "critical",
      "estimated_effort_hours": 16
    },
    {
      "path": "src/services/contextManager.ts",
      "complexity_score": 35,
      "lines": 624,
      "violations": [
        {
          "type": "cyclomatic_complexity",
          "function": "buildSuperContext",
          "line_range": "111-198",
          "complexity": 18,
          "description": "Complex context building with multiple conditional branches and data aggregation",
          "severity": "high"
        },
        {
          "type": "function_length",
          "function": "buildSuperContext",
          "lines": 87,
          "description": "Long function that builds comprehensive context from multiple sources",
          "severity": "high"
        },
        {
          "type": "class_complexity",
          "total_methods": 25,
          "description": "Large service class with too many responsibilities",
          "severity": "medium"
        }
      ],
      "refactoring_priority": "high",
      "estimated_effort_hours": 12
    },
    {
      "path": "src/services/roastingEngine.ts",
      "complexity_score": 42,
      "lines": 693,
      "violations": [
        {
          "type": "cyclomatic_complexity",
          "function": "shouldRoast",
          "line_range": "106-252",
          "complexity": 25,
          "description": "Highly complex decision-making function with numerous branching conditions",
          "severity": "critical"
        },
        {
          "type": "function_length",
          "function": "shouldRoast",
          "lines": 146,
          "description": "Extremely long function handling roast probability calculations",
          "severity": "critical"
        },
        {
          "type": "cognitive_complexity",
          "function": "getMoodModifier",
          "line_range": "384-434",
          "complexity": 12,
          "description": "Complex mood-based calculations with caching and conditional logic",
          "severity": "medium"
        },
        {
          "type": "data_complexity",
          "description": "Complex state management with multiple maps and caching mechanisms",
          "severity": "medium"
        }
      ],
      "refactoring_priority": "critical",
      "estimated_effort_hours": 14
    },
    {
      "path": "src/core/botInitializer.ts",
      "complexity_score": 28,
      "lines": 277,
      "violations": [
        {
          "type": "function_length",
          "function": "createBotConfiguration",
          "line_range": "38-149",
          "lines": 111,
          "description": "Long configuration building function with deeply nested object creation",
          "severity": "high"
        },
        {
          "type": "nesting_depth",
          "function": "createBotConfiguration",
          "max_depth": 5,
          "description": "Deep nesting in configuration object creation",
          "severity": "medium"
        },
        {
          "type": "cyclomatic_complexity",
          "function": "initializeBotServices",
          "line_range": "154-216",
          "complexity": 12,
          "description": "Complex service initialization with dependency management",
          "severity": "medium"
        }
      ],
      "refactoring_priority": "medium",
      "estimated_effort_hours": 8
    }
  ],
  "medium_complexity_files": [
    {
      "path": "src/services/conversationManager.ts",
      "complexity_score": 15,
      "lines": 248,
      "violations": [
        {
          "type": "cyclomatic_complexity",
          "function": "addToConversation",
          "complexity": 8,
          "description": "Circular buffer management logic",
          "severity": "low"
        }
      ],
      "refactoring_priority": "low",
      "estimated_effort_hours": 4
    },
    {
      "path": "src/services/personalityManager.ts",
      "complexity_score": 12,
      "lines": 304,
      "violations": [
        {
          "type": "function_length",
          "function": "addPersonalityDescription",
          "lines": 74,
          "description": "Long function with validation and state management",
          "severity": "medium"
        }
      ],
      "refactoring_priority": "low",
      "estimated_effort_hours": 3
    }
  ],
  "complexity_hotspots": [
    {
      "area": "AI Response Generation",
      "files": ["src/services/gemini.ts"],
      "description": "Complex AI integration with multiple service dependencies and error handling paths",
      "impact": "critical",
      "recommended_action": "Break down large functions and extract service orchestration logic"
    },
    {
      "area": "Roasting Logic",
      "files": ["src/services/roastingEngine.ts"],
      "description": "Highly complex probabilistic decision-making with multiple modifiers",
      "impact": "high",
      "recommended_action": "Extract modifier calculations into separate classes/functions"
    },
    {
      "area": "Context Management",
      "files": ["src/services/contextManager.ts"],
      "description": "Complex data aggregation and context building from multiple sources",
      "impact": "high",
      "recommended_action": "Separate concerns and create focused context builders"
    },
    {
      "area": "Configuration Management",
      "files": ["src/core/botInitializer.ts"],
      "description": "Large configuration objects and complex service initialization",
      "impact": "medium",
      "recommended_action": "Extract configuration to separate files and simplify initialization"
    }
  ],
  "refactoring_recommendations": [
    {
      "priority": "critical",
      "description": "Extract AI generation orchestration from GeminiService.generateResponse",
      "files": ["src/services/gemini.ts"],
      "effort_hours": 8,
      "benefits": ["Improved testability", "Reduced complexity", "Better error handling"]
    },
    {
      "priority": "critical", 
      "description": "Break down roasting decision logic into smaller, focused functions",
      "files": ["src/services/roastingEngine.ts"],
      "effort_hours": 10,
      "benefits": ["Easier testing", "Better maintainability", "Clearer logic flow"]
    },
    {
      "priority": "high",
      "description": "Create specialized context builder classes for different context types",
      "files": ["src/services/contextManager.ts"],
      "effort_hours": 6,
      "benefits": ["Single responsibility", "Improved modularity", "Easier testing"]
    },
    {
      "priority": "medium",
      "description": "Extract configuration objects to separate files with type validation",
      "files": ["src/core/botInitializer.ts"],
      "effort_hours": 4,
      "benefits": ["Better organization", "Type safety", "Easier configuration management"]
    }
  ],
  "design_pattern_opportunities": [
    {
      "pattern": "Strategy Pattern",
      "location": "src/services/roastingEngine.ts",
      "description": "Different roasting strategies based on mood and context",
      "benefit": "Simplify decision logic and improve extensibility"
    },
    {
      "pattern": "Builder Pattern", 
      "location": "src/services/contextManager.ts",
      "description": "Context building could use builder pattern for clarity",
      "benefit": "Improve readability and flexibility of context creation"
    },
    {
      "pattern": "Chain of Responsibility",
      "location": "src/services/gemini.ts",
      "description": "Error handling and validation could use chain pattern",
      "benefit": "Cleaner error handling and validation flow"
    },
    {
      "pattern": "Factory Pattern",
      "location": "src/core/botInitializer.ts", 
      "description": "Configuration creation could benefit from factory pattern",
      "benefit": "Better organization and validation of configuration objects"
    }
  ],
  "metrics": {
    "total_functions_analyzed": 156,
    "functions_over_complexity_threshold": 8,
    "functions_over_length_threshold": 12,
    "average_function_length": 23.4,
    "average_cyclomatic_complexity": 4.8,
    "max_nesting_depth": 5,
    "code_duplication_indicators": 3
  }
}